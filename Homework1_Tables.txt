-- Location table:
DROP TABLE IF EXISTS Location;

CREATE TABLE Location (
	LocationID INT NOT NULL IDENTITY(1, 1) PRIMARY KEY,
	Name VARCHAR(255) NOT NULL
);

-- Tavern table:
DROP TABLE IF EXISTS Tavern;

CREATE TABLE Tavern (
	TavernID INT NOT NULL IDENTITY(1, 1) PRIMARY KEY,
	Name VARCHAR(255) NOT NULL,
	Floors INT NOT NULL,
	LocationID INT NOT NULL FOREIGN KEY REFERENCES Location(LocationID)
);

-- Rats table:
DROP TABLE IF EXISTS Rats;

CREATE TABLE Rats (
	RatID INT NOT NULL IDENTITY(1, 1) PRIMARY KEY,
	Name VARCHAR(255) NOT NULL,
	TavernID INT NOT NULL FOREIGN KEY REFERENCES Tavern(TavernID)
);

-- User table:
DROP TABLE IF EXISTS User;

CREATE TABLE User (
	UserID INT NOT NULL IDENTITY(1, 1) PRIMARY KEY,
	Name VARCHAR(255) NOT NULL,
	Description VARCHAR(255),
	Birthday DATETIME
);

-- Role table:
DROP TABLE IF EXISTS Role;

CREATE TABLE Role (
	RoleID INT NOT NULL IDENTITY(1, 1) PRIMARY KEY,
	Name VARCHAR(255) NOT NULL,
	Description VARCHAR(255)
);

-- Link Role and User:
DROP TABLE IF EXISTS UserRole;

CREATE TABLE UserRole (
	UserID INT NOT NULL FOREIGN KEY REFERENCES User(UserID),
	RoleID INT NOT NULL FOREIGN KEY REFERENCES Role(RoleID)
);

-- Link Tavern and User:
DROP TABLE IF EXISTS TavernUser;

CREATE TABLE TavernUser (
	TavernID INT NOT NULL FOREIGN KEY REFERENCES Tavern(TavernID),
	UserID INT NOT NULL FOREIGN KEY REFERENCES User(UserID)
);

-- Supply table:
DROP TABLE IF EXISTS Supply;

CREATE TABLE Supply (
	SupplyID INT NOT NULL IDENTITY(1, 1) PRIMARY KEY,
	Name VARCHAR(255) NOT NULL,
	Unit VARCHAR(255) NOT NULL,
	Count INT NOT NULL,
	Updated DATETIME NOT NULL,
	TavernID INT NOT NULL FOREIGN KEY REFERENCES Tavern(TavernID)
);

-- Shipment table:
DROP TABLE IF EXISTS Shipment;

CREATE TABLE Shipment (
	ShipmentID INT NOT NULL IDENTITY(1, 1) PRIMARY KEY,
	Cost DECIMAL NOT NULL,
	Amount INT NOT NULL,
	Date DATETIME NOT NULL,
	SupplyID INT NOT NULL FOREIGN KEY REFERENCES Supply(SupplyID),
	TavernID INT NOT NULL FOREIGN KEY REFERENCES Tavern(TavernID)
);

-- Status table:
DROP TABLE IF EXISTS Status;

CREATE TABLE Status (
	StatusID INT NOT NULL IDENTITY(1, 1) PRIMARY KEY,
	Name VARCHAR(255) NOT NULL
);

-- Service table:
DROP TABLE IF EXISTS Service;

CREATE TABLE Service (
	ServiceID INT NOT NULL IDENTITY(1, 1) PRIMARY KEY,
	Name VARCHAR(255) NOT NULL,
	StatusID INT NOT NULL FOREIGN KEY REFERENCES Status(StatusID),
	TavernID INT NOT NULL FOREIGN KEY REFERNECES Tavern(TavernID)
);

-- Sales table:
DROP TABLE IF EXISTS Sales;

CREATE TABLE Sales (
	SaleID INT NOT NULL IDENTITY(1, 1) PRIMARY KEY,
	Price DECIMAL NOT NULL,
	Date DATETIME NOT NULL,
	Amount INT NOT NULL,
	ServiceID INT NOT NULL FOREIGN KEY REFERENCES Service(ServiceID),
	UserID INT NOT NULL FOREIGN KEY REFERENCES User(UserID),
	TavernID INT NOT NULL FOREIGN KEY REFERENCES Tavern(TavernID)
);
